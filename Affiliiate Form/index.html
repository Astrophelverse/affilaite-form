<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultCoin Affiliate Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* Custom VaultCoin Premium Styling */
        .vault-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .card-glow {
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.1);
        }
        
        .input-focus {
            transition: all 0.3s ease;
            background: rgba(55, 65, 81, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-primary:disabled {
            opacity: 0.7;
            transform: none;
            cursor: not-allowed;
        }
        
        .success-animation {
            animation: successPulse 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes successPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .error-shake {
            animation: shake 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        
        .loading-spinner {
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .form-container {
            position: relative;
        }
        
        .header-glow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .select-styled {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }
        
        .select-styled option {
            background-color: #374151;
            color: white;
            padding: 8px;
        }
        
        .select-styled option:hover {
            background-color: #3b82f6;
        }
        
        .select-styled option:checked {
            background-color: #1d4ed8;
        }
        
        .checkbox-custom {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(75, 85, 99, 0.5);
            border-radius: 4px;
            background: rgba(55, 65, 81, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .checkbox-custom:checked {
            background: #3b82f6;
            border-color: #3b82f6;
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
        }
        
        .checkbox-custom:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
  </head>
<body class="vault-gradient min-h-screen flex items-center justify-center p-4">

    
    <div class="form-container w-full max-w-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-3 header-glow">VaultCoin</h1>
            <p class="text-gray-300 text-xl font-medium">Affiliate Application</p>
            <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-blue-600 mx-auto mt-4 rounded-full"></div>
        </div>

        <!-- Form Card -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 card-glow border border-gray-700/50">
            <form id="affiliateForm" class="space-y-6">
                <!-- Full Name -->
                <div>
                    <label for="fullName" class="block text-sm font-medium text-gray-300 mb-2">
                        Full Name *
                    </label>
                    <input 
                        type="text" 
                        id="fullName" 
                        name="fullName" 
                        required
                        class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 input-focus focus:outline-none"
                        placeholder="Enter your full name"
                    >
                    <div id="fullNameError" class="text-red-400 text-sm mt-1 hidden"></div>
                </div>

                <!-- Email -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
                        Email Address *
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required
                        class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 input-focus focus:outline-none"
                        placeholder="Enter your email address"
                    >
                    <div id="emailError" class="text-red-400 text-sm mt-1 hidden"></div>
                </div>

                <!-- Telegram Username -->
                <div>
                    <label for="telegram" class="block text-sm font-medium text-gray-300 mb-2">
                        Telegram Username *
                    </label>
                    <input 
                        type="text" 
                        id="telegram" 
                        name="telegram" 
                        required
                        class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 input-focus focus:outline-none"
                        placeholder="@username"
                    >
                    <div id="telegramError" class="text-red-400 text-sm mt-1 hidden"></div>
                </div>

                <!-- Country/Region -->
                <div>
                    <label for="country" class="block text-sm font-medium text-gray-300 mb-2">
                        Country / Region *
                    </label>
                    <select 
                        id="country" 
                        name="country" 
                        required
                        class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white input-focus focus:outline-none select-styled"
                    >
                        <option value="">Detecting your country...</option>
                    </select>
                    <div id="countryError" class="text-red-400 text-sm mt-1 hidden"></div>
                </div>

                <!-- Affiliate Reach -->
                <div>
                    <label for="reach" class="block text-sm font-medium text-gray-300 mb-2">
                        Affiliate Reach *
                    </label>
                    <textarea 
                        id="reach" 
                        name="reach" 
                        required
                        rows="4"
                        class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-400 input-focus focus:outline-none resize-none"
                        placeholder="Describe your audience, platform, or reach (e.g., social media followers, website traffic, community size)"
                    ></textarea>
                    <div id="reachError" class="text-red-400 text-sm mt-1 hidden"></div>
                </div>

                <!-- Agreement Checkbox -->
                <div class="flex items-start space-x-3">
                    <input 
                        type="checkbox" 
                        id="agreement" 
                        name="agreement" 
                        required
                        class="checkbox-custom mt-1"
                    >
                    <label for="agreement" class="text-sm text-gray-300 leading-relaxed">
                        I agree to the <a href="#" id="termsLink" class="text-blue-400 hover:text-blue-300 underline transition-colors">VaultCoin Affiliate Terms</a> *
                    </label>
                </div>
                <div id="agreementError" class="text-red-400 text-sm mt-1 hidden"></div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full btn-primary text-white font-semibold py-4 px-6 rounded-xl text-lg"
                >
                    <span id="submitText">Submit Application</span>
                    <div id="submitSpinner" class="loading-spinner hidden mx-auto mt-2"></div>
                </button>
            </form>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="hidden mt-6 bg-green-900/50 border border-green-500/50 rounded-2xl p-6 text-center success-animation">
            <div class="text-green-400 text-6xl mb-4">✓</div>
            <h3 class="text-xl font-semibold text-white mb-2">Application Submitted!</h3>
            <p class="text-gray-300">
                Thank you for applying as a VaultCoin Affiliate. We'll review your application and contact you soon.
            </p>
        </div>

        <!-- Terms Modal -->
        <div id="termsModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
            <div class="bg-gray-800 rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-gray-600 shadow-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-white">VaultCoin Affiliate Terms</h3>
                    <button id="closeTerms" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>
                <div class="text-gray-300 space-y-4 text-sm">
                    <p><strong class="text-white">1. Eligibility:</strong> You must be 18+ years old and have a legitimate audience or platform to promote VaultCoin.</p>
                    
                    <p><strong class="text-white">2. Commission Structure:</strong> Earn up to 30% commission on all referred user deposits and mining activities.</p>
                    
                    <p><strong class="text-white">3. Payment Terms:</strong> Commissions are paid monthly via TON wallet. Minimum payout: 100 VLTC.</p>
                    
                    <p><strong class="text-white">4. Promotion Guidelines:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Use only approved marketing materials</li>
                        <li>No false claims or misleading information</li>
                        <li>Comply with local advertising laws</li>
                        <li>No spam or aggressive marketing tactics</li>
                    </ul>
                    
                    <p><strong class="text-white">5. Prohibited Activities:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li>Creating fake accounts or bots</li>
                        <li>Using VPNs to bypass regional restrictions</li>
                        <li>Promoting on adult or gambling sites</li>
                        <li>Any illegal or unethical practices</li>
                    </ul>
                    
                    <p><strong class="text-white">6. Termination:</strong> We reserve the right to terminate affiliate partnerships for violations of these terms.</p>
                    
                    <p><strong class="text-white">7. Changes:</strong> These terms may be updated. Continued participation constitutes acceptance of new terms.</p>
                    
                    <p class="text-xs text-gray-400 mt-6">Last updated: December 2024</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBGG4c9LT5oXLNMVfYqcbRfWAMDcbcj22Y",
            authDomain: "vaultcoin-affiliate-form.firebaseapp.com",
            projectId: "vaultcoin-affiliate-form",
            storageBucket: "vaultcoin-affiliate-form.firebasestorage.app",
            messagingSenderId: "650973294383",
            appId: "1:650973294383:web:c697af85f53c0a8a2bfbda"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Countries list
        const countries = [
            { code: 'AF', name: 'Afghanistan' },
            { code: 'AL', name: 'Albania' },
            { code: 'DZ', name: 'Algeria' },
            { code: 'AD', name: 'Andorra' },
            { code: 'AO', name: 'Angola' },
            { code: 'AR', name: 'Argentina' },
            { code: 'AM', name: 'Armenia' },
            { code: 'AU', name: 'Australia' },
            { code: 'AT', name: 'Austria' },
            { code: 'AZ', name: 'Azerbaijan' },
            { code: 'BH', name: 'Bahrain' },
            { code: 'BD', name: 'Bangladesh' },
            { code: 'BY', name: 'Belarus' },
            { code: 'BE', name: 'Belgium' },
            { code: 'BZ', name: 'Belize' },
            { code: 'BJ', name: 'Benin' },
            { code: 'BT', name: 'Bhutan' },
            { code: 'BO', name: 'Bolivia' },
            { code: 'BA', name: 'Bosnia and Herzegovina' },
            { code: 'BW', name: 'Botswana' },
            { code: 'BR', name: 'Brazil' },
            { code: 'BN', name: 'Brunei' },
            { code: 'BG', name: 'Bulgaria' },
            { code: 'BF', name: 'Burkina Faso' },
            { code: 'BI', name: 'Burundi' },
            { code: 'KH', name: 'Cambodia' },
            { code: 'CM', name: 'Cameroon' },
            { code: 'CA', name: 'Canada' },
            { code: 'CV', name: 'Cape Verde' },
            { code: 'CF', name: 'Central African Republic' },
            { code: 'TD', name: 'Chad' },
            { code: 'CL', name: 'Chile' },
            { code: 'CN', name: 'China' },
            { code: 'CO', name: 'Colombia' },
            { code: 'KM', name: 'Comoros' },
            { code: 'CG', name: 'Congo' },
            { code: 'CR', name: 'Costa Rica' },
            { code: 'HR', name: 'Croatia' },
            { code: 'CU', name: 'Cuba' },
            { code: 'CY', name: 'Cyprus' },
            { code: 'CZ', name: 'Czech Republic' },
            { code: 'CD', name: 'Democratic Republic of the Congo' },
            { code: 'DK', name: 'Denmark' },
            { code: 'DJ', name: 'Djibouti' },
            { code: 'DO', name: 'Dominican Republic' },
            { code: 'EC', name: 'Ecuador' },
            { code: 'EG', name: 'Egypt' },
            { code: 'SV', name: 'El Salvador' },
            { code: 'GQ', name: 'Equatorial Guinea' },
            { code: 'ER', name: 'Eritrea' },
            { code: 'EE', name: 'Estonia' },
            { code: 'ET', name: 'Ethiopia' },
            { code: 'FJ', name: 'Fiji' },
            { code: 'FI', name: 'Finland' },
            { code: 'FR', name: 'France' },
            { code: 'GA', name: 'Gabon' },
            { code: 'GM', name: 'Gambia' },
            { code: 'GE', name: 'Georgia' },
            { code: 'DE', name: 'Germany' },
            { code: 'GH', name: 'Ghana' },
            { code: 'GR', name: 'Greece' },
            { code: 'GT', name: 'Guatemala' },
            { code: 'GN', name: 'Guinea' },
            { code: 'GW', name: 'Guinea-Bissau' },
            { code: 'GY', name: 'Guyana' },
            { code: 'HT', name: 'Haiti' },
            { code: 'HN', name: 'Honduras' },
            { code: 'HK', name: 'Hong Kong' },
            { code: 'HU', name: 'Hungary' },
            { code: 'IS', name: 'Iceland' },
            { code: 'IN', name: 'India' },
            { code: 'ID', name: 'Indonesia' },
            { code: 'IR', name: 'Iran' },
            { code: 'IQ', name: 'Iraq' },
            { code: 'IE', name: 'Ireland' },
            { code: 'IL', name: 'Israel' },
            { code: 'IT', name: 'Italy' },
            { code: 'CI', name: 'Ivory Coast' },
            { code: 'JM', name: 'Jamaica' },
            { code: 'JP', name: 'Japan' },
            { code: 'JO', name: 'Jordan' },
            { code: 'KZ', name: 'Kazakhstan' },
            { code: 'KE', name: 'Kenya' },
            { code: 'KW', name: 'Kuwait' },
            { code: 'KG', name: 'Kyrgyzstan' },
            { code: 'LA', name: 'Laos' },
            { code: 'LV', name: 'Latvia' },
            { code: 'LB', name: 'Lebanon' },
            { code: 'LS', name: 'Lesotho' },
            { code: 'LR', name: 'Liberia' },
            { code: 'LY', name: 'Libya' },
            { code: 'LT', name: 'Lithuania' },
            { code: 'LU', name: 'Luxembourg' },
            { code: 'MO', name: 'Macau' },
            { code: 'MK', name: 'Macedonia' },
            { code: 'MG', name: 'Madagascar' },
            { code: 'MW', name: 'Malawi' },
            { code: 'MY', name: 'Malaysia' },
            { code: 'ML', name: 'Mali' },
            { code: 'MT', name: 'Malta' },
            { code: 'MR', name: 'Mauritania' },
            { code: 'MU', name: 'Mauritius' },
            { code: 'MX', name: 'Mexico' },
            { code: 'MD', name: 'Moldova' },
            { code: 'MC', name: 'Monaco' },
            { code: 'MN', name: 'Mongolia' },
            { code: 'ME', name: 'Montenegro' },
            { code: 'MA', name: 'Morocco' },
            { code: 'MZ', name: 'Mozambique' },
            { code: 'MM', name: 'Myanmar' },
            { code: 'NA', name: 'Namibia' },
            { code: 'NP', name: 'Nepal' },
            { code: 'NL', name: 'Netherlands' },
            { code: 'NZ', name: 'New Zealand' },
            { code: 'NI', name: 'Nicaragua' },
            { code: 'NE', name: 'Niger' },
            { code: 'NG', name: 'Nigeria' },
            { code: 'NO', name: 'Norway' },
            { code: 'OM', name: 'Oman' },
            { code: 'PK', name: 'Pakistan' },
            { code: 'PA', name: 'Panama' },
            { code: 'PG', name: 'Papua New Guinea' },
            { code: 'PY', name: 'Paraguay' },
            { code: 'PE', name: 'Peru' },
            { code: 'PH', name: 'Philippines' },
            { code: 'PL', name: 'Poland' },
            { code: 'PT', name: 'Portugal' },
            { code: 'QA', name: 'Qatar' },
            { code: 'RO', name: 'Romania' },
            { code: 'RU', name: 'Russia' },
            { code: 'RW', name: 'Rwanda' },
            { code: 'SA', name: 'Saudi Arabia' },
            { code: 'SN', name: 'Senegal' },
            { code: 'RS', name: 'Serbia' },
            { code: 'SG', name: 'Singapore' },
            { code: 'SK', name: 'Slovakia' },
            { code: 'SI', name: 'Slovenia' },
            { code: 'SO', name: 'Somalia' },
            { code: 'ZA', name: 'South Africa' },
            { code: 'KR', name: 'South Korea' },
            { code: 'ES', name: 'Spain' },
            { code: 'LK', name: 'Sri Lanka' },
            { code: 'SD', name: 'Sudan' },
            { code: 'SR', name: 'Suriname' },
            { code: 'SZ', name: 'Swaziland' },
            { code: 'SE', name: 'Sweden' },
            { code: 'CH', name: 'Switzerland' },
            { code: 'SY', name: 'Syria' },
            { code: 'TW', name: 'Taiwan' },
            { code: 'TJ', name: 'Tajikistan' },
            { code: 'TZ', name: 'Tanzania' },
            { code: 'TH', name: 'Thailand' },
            { code: 'TL', name: 'Timor-Leste' },
            { code: 'TG', name: 'Togo' },
            { code: 'TO', name: 'Tonga' },
            { code: 'TN', name: 'Tunisia' },
            { code: 'TR', name: 'Turkey' },
            { code: 'TM', name: 'Turkmenistan' },
            { code: 'UG', name: 'Uganda' },
            { code: 'UA', name: 'Ukraine' },
            { code: 'AE', name: 'United Arab Emirates' },
            { code: 'GB', name: 'United Kingdom' },
            { code: 'US', name: 'United States' },
            { code: 'UY', name: 'Uruguay' },
            { code: 'UZ', name: 'Uzbekistan' },
            { code: 'VE', name: 'Venezuela' },
            { code: 'VN', name: 'Vietnam' },
            { code: 'YE', name: 'Yemen' },
            { code: 'ZM', name: 'Zambia' },
            { code: 'ZW', name: 'Zimbabwe' }
        ];

        // Form elements
        const form = document.getElementById('affiliateForm');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const submitSpinner = document.getElementById('submitSpinner');
        const successMessage = document.getElementById('successMessage');
        const countrySelect = document.getElementById('country');
        
        // Terms modal elements
        const termsLink = document.getElementById('termsLink');
        const termsModal = document.getElementById('termsModal');
        const closeTerms = document.getElementById('closeTerms');
        
        // Debug: Check if elements are found
        console.log('Terms link found:', termsLink);
        console.log('Terms modal found:', termsModal);
        console.log('Close terms found:', closeTerms);

        // Populate country dropdown
        function populateCountries() {
            // Clear existing options
            countrySelect.innerHTML = '<option value="">Select your country...</option>';
            
            // Add all countries
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.name;
                option.textContent = country.name;
                countrySelect.appendChild(option);
            });
        }

        // Detect user's country
        async function detectUserCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const userCountry = data.country_name;
                
                // Find and select the user's country
                const countryOption = Array.from(countrySelect.options).find(option => 
                    option.value === userCountry
                );
                
                if (countryOption) {
                    countrySelect.value = userCountry;
                    hideError('country');
                }
            } catch (error) {
                console.log('Could not detect country automatically');
            }
        }

        // Initialize country dropdown
        populateCountries();
        detectUserCountry();

        // Initialize EmailJS
        emailjs.init('ITWb6yT58NWTcw2wU');

        // Email notification function
        async function sendEmailNotification(formData) {
            try {
                const templateParams = {
                    to_email: 'farukhassanahmad@gmail.com',
                    from_name: formData.fullName,
                    from_email: formData.email,
                    telegram: formData.telegram,
                    country: formData.country,
                    reach: formData.reach,
                    timestamp: new Date().toLocaleString()
                };

                await emailjs.send(
                    'service_actte5i',
                    'template_oagr4bc',
                    templateParams
                );
            } catch (error) {
                console.log('Email notification failed:', error);
            }
        }

        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Email notification function
        async function sendEmailNotification(formData) {
            try {
                // Using EmailJS service for email notifications
                // You'll need to set up EmailJS account and replace with your service details
                const emailData = {
                    to_email: 'your-email@example.com', // Replace with your email
                    from_name: 'VaultCoin Affiliate Form',
                    subject: 'New Affiliate Application - VaultCoin',
                    message: `
                        New affiliate application received:
                        
                        Full Name: ${formData.fullName}
                        Email: ${formData.email}
                        Telegram: ${formData.telegram}
                        Country: ${formData.country}
                        Affiliate Reach: ${formData.reach}
                        Timestamp: ${formData.timestamp.toLocaleString()}
                    `
                };

                // For now, we'll use a simple console log
                // In production, you'd integrate with EmailJS, SendGrid, or similar service
                console.log('Email notification data:', emailData);
                
                // You can also save notification data to Firebase for admin panel
                await db.collection('emailNotifications').add({
                    ...emailData,
                    timestamp: new Date(),
                    status: 'pending'
                });
                
            } catch (error) {
                console.error('Error sending email notification:', error);
            }
        }

        // Initialize particles
        createParticles();

        // Validation functions
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function validateTelegram(username) {
            return username.startsWith('@') && username.length > 1;
        }

        function showError(fieldId, message) {
            const errorDiv = document.getElementById(fieldId + 'Error');
            const field = document.getElementById(fieldId);
            
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            field.classList.add('error-shake');
            field.classList.add('border-red-500');
            
            setTimeout(() => {
                field.classList.remove('error-shake');
            }, 500);
        }

        function hideError(fieldId) {
            const errorDiv = document.getElementById(fieldId + 'Error');
            const field = document.getElementById(fieldId);
            
            errorDiv.classList.add('hidden');
            field.classList.remove('border-red-500');
            field.classList.add('border-gray-600');
        }

        function validateField(fieldId, value, validator = null) {
            if (!value.trim()) {
                showError(fieldId, 'This field is required');
                return false;
            }

            if (validator) {
                if (!validator(value)) {
                    if (fieldId === 'email') {
                        showError(fieldId, 'Please enter a valid email address');
                    } else if (fieldId === 'telegram') {
                        showError(fieldId, 'Please enter a valid Telegram username starting with @');
                    }
                    return false;
                }
            }

            hideError(fieldId);
            return true;
        }

        // Real-time validation
        document.getElementById('fullName').addEventListener('input', (e) => {
            validateField('fullName', e.target.value);
        });

        document.getElementById('email').addEventListener('input', (e) => {
            validateField('email', e.target.value, validateEmail);
        });

        document.getElementById('telegram').addEventListener('input', (e) => {
            validateField('telegram', e.target.value, validateTelegram);
        });

        countrySelect.addEventListener('change', (e) => {
            validateField('country', e.target.value);
        });

        document.getElementById('reach').addEventListener('input', (e) => {
            validateField('reach', e.target.value);
        });

        document.getElementById('agreement').addEventListener('change', (e) => {
            if (e.target.checked) {
                hideError('agreement');
            } else {
                showError('agreement', 'You must agree to the terms');
            }
        });

        // Terms modal functionality
        termsLink.addEventListener('click', (e) => {
            e.preventDefault();
            console.log('Terms link clicked');
            termsModal.classList.remove('hidden');
            console.log('Modal should be visible now');
        });

        closeTerms.addEventListener('click', () => {
            termsModal.classList.add('hidden');
        });

        // Close modal when clicking outside
        termsModal.addEventListener('click', (e) => {
            if (e.target === termsModal) {
                termsModal.classList.add('hidden');
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !termsModal.classList.contains('hidden')) {
                termsModal.classList.add('hidden');
            }
        });

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Get form data
            const formData = {
                fullName: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                telegram: document.getElementById('telegram').value.trim(),
                country: document.getElementById('country').value.trim(),
                reach: document.getElementById('reach').value.trim(),
                agreement: document.getElementById('agreement').checked,
                timestamp: new Date()
            };

            // Validate all fields
            const validations = [
                validateField('fullName', formData.fullName),
                validateField('email', formData.email, validateEmail),
                validateField('telegram', formData.telegram, validateTelegram),
                validateField('country', formData.country),
                validateField('reach', formData.reach)
            ];

            if (!formData.agreement) {
                showError('agreement', 'You must agree to the terms');
                return;
            }

            if (validations.some(v => !v)) {
                return;
            }

            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Submitting...';
            submitSpinner.classList.remove('hidden');

            try {
                // Save to Firebase
                await db.collection('affiliateApplications').add(formData);
                
                // Send email notification
                await sendEmailNotification(formData);
                
                // Show success message
                form.classList.add('hidden');
                successMessage.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error submitting form:', error);
                alert('There was an error submitting your application. Please try again.');
                
                // Reset button state
                submitBtn.disabled = false;
                submitText.textContent = 'Submit Application';
                submitSpinner.classList.add('hidden');
            }
        });
    </script>
  </body>
</html>